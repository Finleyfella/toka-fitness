# Forgotten Password Function - handle password reset process
def ForgottenMenu():
    """Display modern password reset interface"""
    reset_window = Window(app, title="Reset Password", width=500, height=500)
    reset_window.bg = COLORS['light']
    
    # Header card
    header_card = Box(reset_window, width="fill", align="top")
    header_card.bg = COLORS['white']
    
    Text(header_card, text="Reset Your Password", size=18, color=COLORS['primary'])
    Text(header_card, text="Enter your email to receive a reset code", size=12, color=COLORS['text_light'])
    
    # Form card
    form_card = Box(reset_window, width="fill", align="top")
    form_card.bg = COLORS['white']
    
    form = Box(form_card, layout="grid")
    Text(form, text="Email:", grid=[0,0])
    reset_email = TextBox(form, grid=[1,0], width=30)
    
    error_text = Text(reset_window, text="", size=10, color=COLORS['danger'])
    reset_code = None
    
    def send_reset_code():
        nonlocal reset_code
        email = reset_email.value.strip()
        
        if not email:
            error_text.value = "Please enter your email"
            return
            
        user_exists = query_database("SELECT userID FROM User WHERE U_Email = ?", (email,))
        if not user_exists:
            error_text.value = "Email not found"
            return
            
        reset_code = str(random.randint(100000, 999999))
        info("Reset Code", f"Your reset code is: {reset_code}")
        
    def reset_password():
        email = reset_email.value.strip()
        code_input = reset_code_input.value
        new_password = new_pw_input.value
        confirm_password = confirm_pw_input.value
        
        if not all([email, code_input, new_password, confirm_password]):
            error_text.value = "Please fill all fields"
            return
            
        if code_input != reset_code:
            error_text.value = "Invalid reset code"
            return
            
        if new_password != confirm_password:
            error_text.value = "Passwords do not match"
            return
            
        is_valid, error_msg = validate_
        is_valid, error_msg = validate_password(new_password)
        if not is_valid:
            error_text.value = error_msg
            return
            
        hashed_pw = bcrypt.hashpw(new_password.encode('utf-8'), bcrypt.gensalt())
        execute_sql("UPDATE User SET U_PW = ? WHERE U_Email = ?", (hashed_pw.decode('utf-8'), email))
        
        info("Success", "Password reset successfully!")
        reset_window.destroy()
    
    # Send reset code button
    send_btn = PushButton(form, text="Send Reset Code", command=send_reset_code, grid=[2,0])
    send_btn.bg = COLORS['accent']
    send_btn.text_color = COLORS['white']
    
    # Reset code input
    Text(form, text="Reset Code:", grid=[0,1])
    reset_code_input = TextBox(form, grid=[1,1], width=15)
    
    # New password fields
    Text(form, text="New Password:", grid=[0,2])
    new_pw_input = TextBox(form, grid=[1,2], width=30, hide_text=True)
    
    Text(form, text="Confirm Password:", grid=[0,3])
    confirm_pw_input = TextBox(form, grid=[1,3], width=30, hide_text=True)
    
    # Action buttons
    button_box = Box(form_card, width="fill", align="bottom")
    
    reset_btn = PushButton(button_box, text="Reset Password", command=reset_password, align="left")
    reset_btn.bg = COLORS['success']
    reset_btn.text_color = COLORS['white']
    
    cancel_btn = PushButton(button_box, text="Cancel", command=lambda: reset_window.destroy(), align="right")
    cancel_btn.bg = COLORS['light']
    cancel_btn.text_color = COLORS['text_dark']
